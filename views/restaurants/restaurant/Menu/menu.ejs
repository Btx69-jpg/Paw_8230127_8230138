<!DOCTYPE html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <title>Visualizar Menu</title>
    <link rel="icon" type="image/png" href="/images/Plataform/LogoSite/logo.png" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Fonte Google -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet" />
    <style>
      .hero {
        background-size: cover;
        background-position: center;
        height: 40vh;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .hero-content {
        position: relative;
        z-index: 2;
        text-align: center;
        color: #fff;
      }
      .dish-card {
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
      }
      .dish-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      }
      .dish-image {
        height: 200px;
        object-fit: cover;
        width: 100%;
      }
      .price-tag {
        font-size: 1.25rem;
        font-weight: 700;
        color: #198754;
      }
    </style>
  </head>
  <body>
    <%- include('../navBarRest') %>
    <% 
      let backgroundImg = ""; 
      if (restaurant.perfil && restaurant.perfil.perfilPhoto && restaurant.perfil.perfilPhoto.trim() !== "") { 
        backgroundImg = restaurant.perfil.perfilPhoto.replace(/\\/g, '/'); 
      } else { 
        backgroundImg = "/images/Plataform/LogoSite/logo.png"; 
      } 
    %>

    <section class="hero" style="background-image: url('<%= backgroundImg %>')">
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <h1><%= restaurant.name %></h1>
        <p>Menu: <%= menu.name %></p>
      </div>
    </section>


    <div>
      <div class="container my-3" style="border-radius: 100;">
        <a href="/restaurants/<%= restaurant.name %>" class="btn btn-primary">&lt;</a>
      </div>
    </div>

    <div class="container my-5">
      <!-- Cabeçalho do Menu -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card border-0 bg-light">
            <div class="card-body text-center">
              <h2 class="card-title mb-3"><%= menu.name %></h2>
              <div class="d-flex justify-content-center gap-4">
                <span class="badge bg-primary fs-6"><%= menu.type %></span>
                <span class="badge bg-secondary fs-6"><%= menu.countDish %> pratos</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row justify-content-center mb-4">
        <form action="/restaurants/<%= restaurant.name %>/search" method="GET" class="col-md-10 row g-3 justify-content-center">
      
          <div class="col-md-4">
            <label for="dishName" class="form-label">Nome do Menu:</label>
            <input type="text" 
                   class="form-control" 
                   name="dishName" 
                   id="dishName" 
                   placeholder="Nome do prato" 
                   maxlength="50" 
                   pattern="[A-Za-z\s]*"
                   value="<%= filters.dishName %>">
          </div>
      
          <% if (categories && categories.length > 0) { %>  
            <div class="col-md-4">
              <label for="type" class="form-label">Tipo do Prato:</label>
              <select name="type" id="type" class="form-select" required>
                <option value="all">Todos</option>                
                <% categories.forEach(function(category) { %>
                  <option value="<%= category %>" <%= filters.type === category ? 'selected' : '' %>><%= category %></option>
                <% }); %>
              </select>
            </div>
          <% } %>
      
          <div class="col-md-4">
            <label for="price" class="form-label">Preço:</label>
            <input type="number" 
                   class="form-control" 
                   name="price" 
                   id="price" 
                   placeholder="Preço" 
                   value="<%= filters.price %>">
          </div>
      
          <% if (portions && portions.length > 0) { %>    
            <div class="col-md-4">
              <label for="portion" class="form-label">Porção:</label>
              <select name="portion" id="portion" class="form-select" required>
                <option value="all">Todos</option>
                <% portions.forEach(function(port) { %>
                  <option value="<%= port.portion %>" <%= filters.type === port.portion ? 'selected' : '' %>><%= port.portion %></option>
                <% }); %>
              </select>
            </div>
          <% } %>
      
          <div class="col-12 d-flex justify-content-center mt-3 gap-2">
            <a href="/restaurants/<%= restaurant.name %>" class="btn btn-secondary">Clear</a>
            <button type="submit" class="btn btn-primary">Submeter</button>
          </div>
      
        </form>
      </div>      

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% menu.dishes.forEach(function(dish) { %>
          <div class="col">
            <div class="card dish-card h-100">
              <% if (dish.photo) { %>
                <img src="<%= dish.photo %>" class="card-img-top dish-image" alt="<%= dish.name %>" />
              <% } else { %>
                <div class="dish-image bg-secondary d-flex align-items-center justify-content-center">
                  <span class="text-white">Sem imagem</span>
                </div>
              <% } %>
              <div class="card-body">
                <h5 class="card-title"><%= dish.name %></h5>
                <p class="card-text text-muted"><%= dish.description %></p>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge bg-info"><%= dish.category %></span>
                  <span class="price-tag"><%= dish.price.toFixed(2) %> €</span>
                </div>
                <div class="mt-3">
                  <h6>Porções:</h6>
                  <% dish.portions.forEach(function(portion) { %>
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <% if (portion.portion && portion.portion.portion) { %>
                          <%= portion.portion.portion %>
                        <% } else if (portion.portion) { %>
                          <%= portion.portion %>
                        <% } else { %>
                          Porção não disponível
                        <% } %>
                      </span>
                      <span class="text-muted"><%= portion.price.toFixed(2) %> €</span>
                    </div>
                  <% }); %>
                </div>

                <div class="mt-3">
                  <table class="table table-sm">
                    <thead>
                      <tr><th>Nutriente</th><th>Qtd./100 g</th></tr>
                    </thead>
                    <tbody>
                      <% dish.nutritionalInfo.forEach(n => { %>
                        <tr>
                          <td><%= n.name %></td>
                          <td>
                            Cals: <%= n.per100g.calories %> kcal,
                            Prot: <%= n.per100g.protein %> g,
                            Lip:  <%= n.per100g.fat %> g,
                            Carb: <%= n.per100g.carbohydrates %> g
                          </td>
                        </tr>
                      <% }) %>
                    </tbody>
                  </table>
                </div>                  
              </div>
            </div>
          </div>
        <% }); %>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
