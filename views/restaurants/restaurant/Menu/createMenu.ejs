<!DOCTYPE html>
<html>
  <head>
    <!-- Logotipo-->
    <link
      rel="icon"
      type="image/png"
      href="/images/Plataform/LogoSite/logo.png"
    />
    <!-- Link da fonte -->

    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap"rel="stylesheet"/>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  
    <!-- CSS-->
    <link rel="stylesheet" href="/stylesheets/Restaurants/Restaurant/Pratos/portion.css">
  </head>
  <body>
    <%- include('../navBarRest') %>

    <%- include('../../../hero', { content: restaurant.name, title: "Criar Menu" }) %>

    <div>
      <div class="container my-3" style="border-radius: 100">
        <a href="/restaurants/<%= restaurant.name %>" class="btn btn-primary">&lt;</a>
      </div>
    </div>

    <% if (error && error.length > 0) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Erro!</strong> <%= error %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
    <% } %>

    <!-- Formulário do Menu -->
    <div class="container my-5">
      <!-- Altere a action para a rota que processa o salvamento do Menu, incluindo os pratos -->
      <form
        action="/restaurants/<%= restaurant.name %>/saveMenu"
        method="POST"
        enctype="multipart/form-data"
      >
        <!-- Dados do Menu -->
        <div class="mb-3">
          <label for="menuName" class="form-label">Nome do Menu:</label>
          <input
            type="text"
            name="name"
            id="menuName"
            class="form-control"
            placeholder="Nome do Menu"
            required
            maxlength="50"
            pattern="^(?!.*[\\/]).+$"
            oninvalid="this.setCustomValidity('Introduza somente letras e espaços, máximo 50 caracteres.')"
          />
        </div>
        <div class="mb-3">
          <label for="menuPhoto" class="form-label">Foto do Menu:</label>
          <input
            type="file"
            accept="image/*"
            name="menuPhoto"
            id="menuPhoto"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label for="type" class="form-label">Tipo do Menu:</label>
          <% if (categories && categories.length > 0) { %>
            <select name="type" id="type" class="form-select" required>
              <% categories.forEach(function(cat) { %>
                <option value="<%= cat.category %>"><%= cat.category %></option>
              <% }); %>
            </select>
          <% } else { %>
            <!-- Caso não haja categorias, entrada de texto -->
            <input
              type="text"
              name="type"
              id="type"
              class="form-control"
              required
            />
          <% } %>
        </div>

        <!-- Área de cadastro dos pratos -->
        <h4>Pratos</h4>
        <div id="dishesContainer">
          <% if (error && error.length > 0) { %>
            <div class="alert alert-danger" role="alert"><%= error %></div>
          <% } %>

          <!-- Primeiro formulário de prato (index 0) -->
          <div class="dish-form border p-3 mb-3" data-index="0">
            <h5>Prato 1</h5>
            <div class="mb-3">
              <label for="dishName0" class="form-label">Nome:</label>
              <input
                type="text"
                name="dishes[0][name]"
                id="dishName0"
                class="form-control"
                placeholder="Nome do prato"
                required
                maxlength="50"
                pattern="^[A-Za-zÀ-ÿ\s]+$"
              />
            </div>
            <div class="mb-3">
              <label for="dishDescription0" class="form-label">Descrição:</label>
              <input
                type="text"
                name="dishes[0][description]"
                id="dishDescription0"
                class="form-control"
                placeholder="Descrição do prato"
                required
                maxlength="250"
                oninvalid="this.setCustomValidity('Descrição do prato, máximo 250 caracteres.')"
              />
            </div>
            <% if (categories && categories.length > 0) { %>
              <div class="mb-3">
                <label for="dishCategory0" class="form-label">Categoria:</label>
                <select
                  name="dishes[0][category]"
                  id="dishCategory0"
                  class="form-select"
                  required
                >
                  <% categories.forEach(function(cat) { %>
                    <option value="<%= cat.category %>"><%= cat.category %></option>
                  <% }); %>
                </select>
              </div>
            <% } else { %>
              <div class="mb-3">
                <label for="dishCategory0" class="form-label">Categoria:</label>
                <input
                  type="text"
                  name="dishes[0][category]"
                  id="dishCategory0"
                  class="form-control"
                  required
                />
              </div>
            <% } %>
            <div class="mb-3">
              <label for="dishPrice0" class="form-label">Preço:</label>
              <input
                type="number"
                name="dishes[0][price]"
                id="dishPrice0"
                class="form-control"
                placeholder="Preço do prato"
                required
                min="0"
                step="0.01"
                oninvalid="this.setCustomValidity('Informe um preço válido.')"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Porções:</label>
              <div id="portionsContainer-0" class="portions-container mb-3" data-index="0">
                <!-- Porções adicionadas aparecerão aqui -->
              </div>
              <div class="input-group">
                <select
                  id="portionSelect-0"
                  class="form-select portion-select"
                  data-index="0"
                  onchange="addPortion(this)"
                >
                  <option value="">Selecione uma porção...</option>
                  <% portions.forEach(function(portion) { %>
                    <option value="<%= portion._id %>">
                      <%= portion.portion %>
                    </option>
                  <% }); %>
                </select>
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  onclick="addPortion(document.getElementById('portionSelect-0'))"
                >
                  Adicionar
                </button>
              </div>
              <small class="text-danger portion-error" style="display: none">
                Pelo menos uma porção é obrigatória.
              </small>
            </div>
            <div class="mb-3">
              <label for="dishPhoto0" class="form-label">Foto do Prato:</label>
              <input
                type="file"
                accept="image/*"
                name="dishes[0][photo]"
                id="dishPhoto0"
                class="form-control"
                required
              />
            </div>
          </div>
        </div>

        <!-- Botão para adicionar mais formulários de prato -->
        <div class="mb-3">
          <button type="button" id="addDishBtn" class="btn btn-secondary">
            Adicionar Prato
          </button>
        </div>

        <!-- Botão para submeter o formulário do Menu -->
        <div class="mb-3">
          <button type="submit" class="btn btn-primary">Salvar Menu</button>
        </div>
      </form>
    </div>

    <!-- Script para adição e remoção dinâmica dos formulários de prato -->
    <script src="/javascripts/Restaurants/Restaurant/Menus/createMenus.js"></script>
  </body>
</html>
