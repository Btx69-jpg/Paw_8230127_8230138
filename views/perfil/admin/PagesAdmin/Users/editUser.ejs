<!DOCTYPE html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/images/Plataform/LogoSite/logo.png" />
    <title>Editar Conta</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!--CSS -->
    <link rel="stylesheet" href="/stylesheets/Perfils/Admin/PagesAdmin/Users/editUser.css">
  </head>
  <body>
    <main>
      <div class="signup-container">
        <h1>Editar conta</h1>
        <form action="/perfil/admin/listUsers/editUser/<%= userD._id %>" method="POST" id="signupForm" class="needs-validation" novalidate>
          <%- include('../../../../login/editUserCampos') %>
          <div class="form-group" id="divPrioridade">
            <label for="priority">Prioridade</label>
            <select id="priority" name="priority" class="form-control" onchange="inputDono()" required>
              <option value="Cliente" <%= userD.perfil.priority === 'Cliente' ? 'selected' : '' %>>Cliente</option>
              <option value="Admin" <%= userD.perfil.priority === 'Admin' ? 'selected' : '' %>>Admin</option>
              <option value="Dono" <%= userD.perfil.priority === 'Dono' ? 'selected' : '' %>>Dono</option>
              <option value="Funcionario" <%= userD.perfil.priority === 'Funcionario' ? 'selected' : '' %>>Funcionário</option>
            </select>
          </div>

          <% if (restaurants && restaurants.length > 0 && userD.perfil.priority === 'Dono') { %>
            <% for (let i = 0; i < restaurants.length; i++) { %>
              <div class="form-group" id="divRestaurant">
                <label for="restaurant">Nome do restaurante</label>
                <input type="text" id="restaurant" class="form-control" name="restaurant"
                       placeholder="Introduza o nome do restaurante" maxlength="100"
                       pattern="^(?!.*[\\/]).+$" title="O nome não pode conter '/' ou '\\'"
                       value="<%= restaurants[i].name %>" required>
              </div>
            <% } %>
          <% } %>

          <button type="submit">Alterar</button>
          <div class="d-grid gap-2">
            <a href="/perfil/admin/listUsers" class="btn btn-secondary">Voltar</a>
            <a href="/perfil/admin/createUser" class="btn btn-secondary">Limpar</a>
          </div>
        </form>
      </div>
    </main>

    <script>
      function inputDono() {
        const valueSelectBox = document.getElementById('priority').value;
        let divRestaurant = document.getElementById('divRestaurant');
        if (!divRestaurant && valueSelectBox === 'Dono') {
          const labelRest = document.createElement('label');
          labelRest.htmlFor = 'restaurant';
          labelRest.textContent = 'Nome do restaurante:';

          const inputRest = document.createElement('input');
          inputRest.type = 'text';
          inputRest.name = 'restaurant';
          inputRest.id = 'restaurant';
          inputRest.className = 'form-control';
          inputRest.placeholder = 'Introduza o nome do restaurante';
          inputRest.maxLength = 100;
          inputRest.pattern = '^(?!.*[\\/]).+$';
          inputRest.title = "O nome não pode conter '/' ou '\\'";
          inputRest.required = true;

          const newDiv = document.createElement('div');
          newDiv.id = 'divRestaurant';
          newDiv.className = 'form-group';
          newDiv.append(labelRest, inputRest);

          document.getElementById('divPrioridade').after(newDiv);
        } else if (divRestaurant && valueSelectBox !== 'Dono') {
          divRestaurant.remove();
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>